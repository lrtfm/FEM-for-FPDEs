% Test class FracHistPart
c_t = 3;
alpha = 0.8;
ufun = @(t)t^c_t;
dufun = @(t)t^(c_t-alpha)/gamma(c_t + 1 - alpha)*gamma(c_t+1);
qformula.alpha = alpha;
qformula.w = 1;

T = 1;
m = 100;
dt = T/m;
t_array = dt*(0:m);
u0 = ufun(0);
fhp = FracHistPart(qformula, t_array, u0);
un = u0;
du_numerical = zeros(m, 1);
du_exact = zeros(m, 1);
left = zeros(m, 3);
for i = 1:m
    [fhp, uh] = fhp.update(i, un);
    % uh = fhp.get_history_array(i);
    un = ufun(i*dt);
    du_numerical(i) = fhp.get_wn(i)*un - uh;
    du_exact(i) = dufun(i*dt);
    left(i,:) = [uh, un, fhp.get_wn(i)]; 
end
plot(dt*(1:m), du_exact, dt*(1:m), du_numerical)
legend('du_exact', 'du_numerical');

% right is the right left value, compare left and right.
right = [
    0.0 1.0000000000000002e-06 43.3588241648
    3.69114383369e-05 8.000000000000001e-06 43.3588241648
    0.000297531673748 2.6999999999999996e-05 43.3588241648
    0.00101553850758 6.400000000000001e-05 43.3588241648
    0.00243147099086 0.00012500000000000003 43.3588241648
    0.00478961692768 0.00021599999999999996 43.3588241648
    0.00833668874253 0.0003430000000000001 43.3588241648
    0.0133211151914 0.0005120000000000001 43.3588241648
    0.0199926124594 0.0007289999999999999 43.3588241648
    0.0286019026414 0.0010000000000000002 43.3588241648
    0.039400518057 0.001331 43.3588241648
    0.052640659232 0.0017279999999999997 43.3588241648
    0.0685750882896 0.002197 43.3588241648
    0.0874570467174 0.0027440000000000008 43.3588241648
    0.109540190498 0.0033749999999999995 43.3588241648
    0.135078537969 0.004096000000000001 43.3588241648
    0.164326427235 0.004913000000000001 43.3588241648
    0.1975384809 0.0058319999999999995 43.3588241648
    0.234969576513 0.0068590000000000005 43.3588241648
    0.276874821534 0.008000000000000002 43.3588241648
    0.323509531924 0.009260999999999998 43.3588241648
    0.375129213695 0.010648 43.3588241648
    0.43198954688 0.012167 43.3588241648
    0.494346371512 0.013823999999999998 43.3588241648
    0.562455675289 0.015625 43.3588241648
    0.636573582657 0.017576 43.3588241648
    0.7169563451 0.019683000000000003 43.3588241648
    0.803860332463 0.021952000000000006 43.3588241648
    0.897542025163 0.024388999999999994 43.3588241648
    0.99825800717 0.026999999999999996 43.3588241648
    1.10626495966 0.029790999999999998 43.3588241648
    1.22181965525 0.032768000000000005 43.3588241648
    1.34517895274 0.035937000000000004 43.3588241648
    1.47659979234 0.039304000000000006 43.3588241648
    1.61633919127 0.04287500000000001 43.3588241648
    1.7646542397 0.046655999999999996 43.3588241648
    1.92180209708 0.050653 43.3588241648
    2.08803998869 0.054872000000000004 43.3588241648
    2.26362520245 0.059319000000000004 43.3588241648
    2.44881508602 0.06400000000000002 43.3588241648
    2.64386704404 0.06892100000000001 43.3588241648
    2.84903853561 0.07408799999999999 43.3588241648
    3.06458707188 0.079507 43.3588241648
    3.29077021391 0.085184 43.3588241648
    3.52784557051 0.09112500000000001 43.3588241648
    3.77607079638 0.097336 43.3588241648
    4.03570359025 0.10382300000000001 43.3588241648
    4.30700169319 0.11059199999999998 43.3588241648
    4.59022288696 0.11764899999999999 43.3588241648
    4.88562499257 0.125 43.3588241648
    5.19346586876 0.13265100000000002 43.3588241648
    5.51400341074 0.140608 43.3588241648
    5.84749554884 0.148877 43.3588241648
    6.19420024735 0.15746400000000002 43.3588241648
    6.55437550334 0.16637500000000005 43.3588241648
    6.92827934562 0.17561600000000005 43.3588241648
    7.31616983365 0.18519300000000005 43.3588241648
    7.71830505662 0.19511199999999995 43.3588241648
    8.13494313247 0.20537899999999998 43.3588241648
    8.56634220703 0.21599999999999997 43.3588241648
    9.01276045317 0.226981 43.3588241648
    9.47445607 0.23832799999999998 43.3588241648
    9.95168728206 0.250047 43.3588241648
    10.4447123387 0.26214400000000004 43.3588241648
    10.9537895131 0.274625 43.3588241648
    11.4791771021 0.28749600000000003 43.3588241648
    12.021133425 0.30076300000000006 43.3588241648
    12.5799168232 0.31443200000000004 43.3588241648
    13.1557856598 0.3285090000000001 43.3588241648
    13.7489983187 0.3430000000000001 43.3588241648
    14.3598132042 0.3579109999999999 43.3588241648
    14.9884887405 0.37324799999999997 43.3588241648
    15.6352833711 0.38901699999999995 43.3588241648
    16.3004555585 0.405224 43.3588241648
    16.9842637836 0.421875 43.3588241648
    17.6869665452 0.43897600000000003 43.3588241648
    18.4088223598 0.456533 43.3588241648
    19.1500897609 0.47455200000000003 43.3588241648
    19.9110272988 0.49303900000000006 43.3588241648
    20.6918935402 0.5120000000000001 43.3588241648
    21.4929470676 0.531441 43.3588241648
    22.3144464794 0.5513680000000001 43.3588241648
    23.156650389 0.5717870000000002 43.3588241648
    24.0198174251 0.5927039999999999 43.3588241648
    24.9042062306 0.6141249999999999 43.3588241648
    25.8100754631 0.636056 43.3588241648
    26.7376837939 0.658503 43.3588241648
    27.6872899082 0.681472 43.3588241648
    28.6591525047 0.7049690000000001 43.3588241648
    29.653530295 0.7290000000000001 43.3588241648
    30.6706820038 0.7535710000000001 43.3588241648
    31.7108663684 0.778688 43.3588241648
    32.7743421386 0.8043570000000001 43.3588241648
    33.8613680761 0.8305840000000001 43.3588241648
    34.9722029546 0.8573750000000002 43.3588241648
    36.1071055598 0.8847359999999999 43.3588241648
    37.2663346883 0.912673 43.3588241648
    38.4501491485 0.9411919999999999 43.3588241648
    39.6588077595 0.970299 43.3588241648
    40.8925693514 1.0 43.3588241648];
